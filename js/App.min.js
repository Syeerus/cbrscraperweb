!function t(e,s,n){function i(o,l){if(!s[o]){if(!e[o]){var r="function"==typeof require&&require;if(!l&&r)return r(o,!0);if(a)return a(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var d=s[o]={exports:{}};e[o][0].call(d.exports,(function(t){return i(e[o][1][t]||t)}),d,d.exports,t,e,s,n)}return s[o].exports}for(var a="function"==typeof require&&require,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var n=t("./UserInterface"),i=function(){function t(){this._radioData=null,this._dataTransferAttempts=0}return t.getInstance=function(){return t._instance||(t._instance=new t),t._instance},t.destroyInstance=function(){t._instance=null},t.prototype.getRadioData=function(){return this._radioData},t.prototype.init=function(){this._startDataFileTransfer()},t.prototype._startDataFileTransfer=function(){++this._dataTransferAttempts,console.log("Data file download attempt #"+this._dataTransferAttempts);var e=new XMLHttpRequest,s=this._onDataFileTransferFailure.bind(this,e);e.addEventListener("load",this._onDataFileLoaded.bind(this,e)),e.addEventListener("error",s),e.addEventListener("abort",s),e.open("GET",t.DATA_FILE),e.responseType="arraybuffer",e.send()},t.prototype._onDataFileLoaded=function(t){if(200===t.status){var e=new Uint8Array(t.response),s=window.URL.createObjectURL(new Blob([document.querySelector("#decompress-worker").textContent])),i=new Worker(s),a=this;i.onmessage=function(t){try{var e=new TextDecoder;a._radioData=JSON.parse(e.decode(t.data)),console.log("Data file successfully parsed.")}catch(t){console.log(t)}window.URL.revokeObjectURL(s),i.terminate(),n.UserInterface.getInstance().init()},i.onerror=function(t){console.log("An error occured: ",t)};var o=document.location.href,l=o.indexOf("index.html");l>-1&&(o=o.substring(0,l)),i.postMessage({data:e,url:o})}else console.log("Error downloading data file: "+t.statusText)},t.prototype._onDataFileTransferFailure=function(e){console.log("An error occured while transferring the file."),console.log("Status: ",e.statusText),this._dataTransferAttempts<t.MAX_DATA_TRANSFER_ATTEMPTS&&this._startDataFileTransfer()},t.DATA_FILE="cbrs.db.json.bz2",t.MAX_DATA_TRANSFER_ATTEMPTS=3,t}();s.App=i,i.getInstance().init()},{"./UserInterface":4}],2:[function(t,e,s){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])})(t,e)},function(t,e){function s(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)});Object.defineProperty(s,"__esModule",{value:!0});var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return i(e,t),e}(Error);s.ElementsNotFoundException=a},{}],3:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var n=t("./App"),i=function(){function t(){}return t.getInstance=function(){return t._instance||(t._instance=new t),t._instance},t.destroyInstance=function(){t._instance=null},t.prototype.searchTotal=function(t,e,s,i,a){if(t.length<=0)return 0;for(var o="",l=0;l<t.length;++l)o+="?,";var r="SELECT COUNT(*) AS total_records FROM ? AS playlists INNER JOIN ? AS songs ON playlists.song_id = songs.id INNER JOIN ? AS artists ON songs.artist_id = artists.id INNER JOIN ? AS stations ON playlists.station_id = stations.id WHERE playlists.station_id IN ("+o.substring(0,o.length-1)+") AND artists.name LIKE ? AND songs.title LIKE ? AND playlists.timestamp >= ? AND playlists.timestamp <= ?",c=n.App.getInstance().getRadioData(),d=[c.playlists,c.songs,c.artists,c.stations].concat(t).concat([e,s,i,a]);return this._exec(r,d)[0].total_records},t.prototype.search=function(t,e,s,i,a,o,l){if(t.length<=0)return[];for(var r="",c=0;c<t.length;++c)r+="?,";var d="SELECT stations.name AS station_name, artists.name AS artist_name, songs.title AS song_title, playlists.timestamp AS timestamp FROM ? AS playlists INNER JOIN ? AS songs ON playlists.song_id = songs.id INNER JOIN ? AS artists ON songs.artist_id = artists.id INNER JOIN ? AS stations ON playlists.station_id = stations.id WHERE playlists.station_id IN ("+r.substring(0,r.length-1)+") AND artists.name LIKE ? AND songs.title LIKE ? AND playlists.timestamp >= ? AND playlists.timestamp <= ? ORDER BY playlists.timestamp LIMIT "+o+" OFFSET "+l,p=n.App.getInstance().getRadioData(),h=[p.playlists,p.songs,p.artists,p.stations].concat(t).concat([e,s,i,a]);return this._exec(d,h)},t.prototype.getMostPlayedSongs=function(t,e){var s="SELECT COUNT(*) AS play_count, FIRST(artists.name) AS artist_name, FIRST(songs.title) AS song_title FROM ? AS playlists INNER JOIN ? AS songs ON playlists.song_id = songs.id INNER JOIN ? AS artists ON songs.artist_id = artists.id WHERE playlists.station_id = ? GROUP BY playlists.song_id ORDER BY play_count DESC LIMIT "+e,i=n.App.getInstance().getRadioData(),a=[i.playlists,i.songs,i.artists,t];return this._exec(s,a)},t.prototype.getMostPlayedArtists=function(t,e){var s="SELECT COUNT(*) AS play_count, FIRST(artists.name) AS artist_name FROM ? AS playlists INNER JOIN ? AS songs ON playlists.song_id = songs.id INNER JOIN ? AS artists ON songs.artist_id = artists.id WHERE playlists.station_id = ? GROUP BY songs.artist_id ORDER BY play_count DESC LIMIT "+e,i=n.App.getInstance().getRadioData(),a=[i.playlists,i.songs,i.artists,t];return this._exec(s,a)},t.prototype.getMostPlayedChristmasSongs=function(t,e){for(var s="SELECT COUNT(*) AS play_count, FIRST(artists.name) AS artist_name, FIRST(songs.title) AS song_title FROM ? AS playlists INNER JOIN ? AS songs ON playlists.song_id = songs.id INNER JOIN ? AS artists ON songs.artist_id = artists.id WHERE playlists.station_id = ? AND (",i=["christmas","jingle","bells","reindeer","santa","baby it's cold","snow","feliz navidad","grandma got run over","little drummer","mary","december","winter","let it snow","frosty"],a=0;a<i.length;++a)i[a]="%"+i[a]+"%",s+="songs.title LIKE ? ",a<i.length-1&&(s+="OR ");s+=") GROUP BY playlists.song_id ORDER BY play_count DESC LIMIT "+e;var o=n.App.getInstance().getRadioData(),l=[o.playlists,o.songs,o.artists,t].concat(i);return this._exec(s,l)},t.prototype._exec=function(t,e){return t===this._prevSql&&this._prevStmt?this._prevStmt(e):(this._prevSql=t,this._prevStmt=window.alasql.compile(t),this._prevStmt(e))},t}();s.PlaylistModel=i},{"./App":1}],4:[function(t,e,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var n=t("./App"),i=t("./PlaylistModel"),a=t("./Exceptions");function o(t,e){void 0===e&&(e=!1);var s=null;if(!e){if(!(s=document.querySelector(t)))throw new a.ElementsNotFoundException('Could not find element "'+t+'"');return{single:s,multi:null}}if(0===(s=document.querySelectorAll(t)).length)throw new a.ElementsNotFoundException('Could not find any elements with the selector "'+t+'"');return{single:null,multi:s}}var l=function(){function t(){this._pageNumber=0,this._onPaginationLinkClickCallback=this._onPaginationLinkClick.bind(this)}return t.getInstance=function(){return t._instance||(t._instance=new t),t._instance},t.destroyInstance=function(){t._instance=null},t.prototype.init=function(){try{this._selStations=o("#sel-stations").single,this._chkAllStations=o("#chk-all-stations").single,this._txtArtist=o("#txt-artist").single,this._txtSongTitle=o("#txt-song-title").single,this._dateStart=o("#date-start").single,this._dateEnd=o("#date-end").single,this._btnSearchSubmit=o("#btn-search-submit").single,this._btnSearchClear=o("#btn-search-clear").single,this._selLimit=o("#sel-limit").single,this._playlistsPagination=o("#playlists-pagination").single,this._playlistsPaginationPrev=o("#playlists-pagination-prev").single,this._playlistsPaginationNext=o("#playlists-pagination-next").single,this._opt100MostPlayedSongs=o("#opt-100-most-played-songs").single,this._opt100MostPlayedArtists=o("#opt-100-most-played-artists").single,this._opt100MostPlayedChristmas=o("#opt-100-most-played-christmas").single,this._populateSelStations(),this._setupEventListeners(),this._enableControls(!0),this._populateStationOptions();var t=n.App.getInstance().getRadioData();o("#data-stats").single.textContent="Loaded: "+t.stations.length+" stations, "+t.artists.length+" artists, "+t.songs.length+" songs, "+t.playlists.length+" playlist entries",this._selectAllStations(this._chkAllStations.checked)}catch(t){console.log(t)}},t.prototype._populateSelStations=function(){var t=n.App.getInstance().getRadioData();if(t)for(var e=0,s=t.stations;e<s.length;e++){var i=s[e],a=document.createElement("option");a.value=i.id,a.text=i.name,this._selStations.appendChild(a)}},t.prototype._populateStationOptions=function(){for(var t=o("#opt-stations").single,e=0,s=n.App.getInstance().getRadioData().stations;e<s.length;e++){var i=s[e],a=document.createElement("label");a.htmlFor="opt-station-"+i.id,a.className="form-radio";var l=document.createElement("input");l.id=a.htmlFor,l.type="radio",l.name="opt-station",l.value=i.id,l.addEventListener("change",this._onDataSelectionChange.bind(this)),a.appendChild(l);var r=document.createElement("i");r.className="form-icon",a.appendChild(r);var c=document.createTextNode(i.name);a.appendChild(c),t.appendChild(a)}},t.prototype._setupEventListeners=function(){this._chkAllStations.addEventListener("change",this._onChkAllStationsChange.bind(this)),this._btnSearchSubmit.addEventListener("click",this._onBtnSearchSubmitClick.bind(this)),this._btnSearchClear.addEventListener("click",this._onBtnSearchClearClick.bind(this)),this._opt100MostPlayedArtists.addEventListener("change",this._onDataSelectionChange.bind(this)),this._opt100MostPlayedSongs.addEventListener("change",this._onDataSelectionChange.bind(this)),this._opt100MostPlayedChristmas.addEventListener("change",this._onDataSelectionChange.bind(this))},t.prototype._enableControls=function(t){var e=!t;this._selStations.disabled=e,this._chkAllStations.disabled=e,this._txtArtist.disabled=e,this._txtSongTitle.disabled=e,this._dateStart.disabled=e,this._dateEnd.disabled=e,this._btnSearchSubmit.disabled=e,this._btnSearchClear.disabled=e,this._selLimit.disabled=e,this._opt100MostPlayedSongs.disabled=e,this._opt100MostPlayedArtists.disabled=e,this._opt100MostPlayedChristmas.disabled=e},t.prototype._selectAllStations=function(t){for(var e=0;e<this._selStations.options.length;++e)this._selStations.options[e].selected=t},t.prototype._getSelectedStations=function(){for(var t=[],e=0;e<this._selStations.options.length;++e)this._selStations.options[e].selected&&t.push(parseInt(this._selStations.options[e].value,10));return t},t.prototype._onChkAllStationsChange=function(){this._selectAllStations(this._chkAllStations.checked)},t.prototype._onBtnSearchSubmitClick=function(){this._performSearch()},t.prototype._onBtnSearchClearClick=function(){this._selectAllStations(!1),this._txtArtist.value="",this._txtSongTitle.value="",this._dateStart.value="",this._dateEnd.value="",this._chkAllStations.checked=!1,this._selLimit.selectedIndex=0},t.prototype._onDataSelectionChange=function(){var t=document.forms[0].elements.namedItem("opt-station").value,e=document.forms[0].elements.namedItem("opt-data-selection").value;if(""!==t&&""!==e){var s=parseInt(t,10),n=null,a=[],l=[];switch(e){case"100_mp_songs":n=i.PlaylistModel.getInstance().getMostPlayedSongs(s,100),a=["Count","Artist","Song Title"],l=["play_count","artist_name","song_title"];break;case"100_mp_artists":n=i.PlaylistModel.getInstance().getMostPlayedArtists(s,100),a=["Count","Artist"],l=["play_count","artist_name"];break;case"100_mp_christmas":n=i.PlaylistModel.getInstance().getMostPlayedChristmasSongs(s,100),a=["Count","Artist","Song Title"],l=["play_count","artist_name","song_title"]}if(null!==n){var r=document.getElementById("data-table");r&&r.parentElement.removeChild(r),r=this._createTable("data-table",a,l,n),o("#data-table-container").single.appendChild(r)}}},t.prototype._performSearch=function(t){void 0===t&&(t=!0),t&&(this._pageNumber=0);var e=this._getSelectedStations(),s="%"+this._txtArtist.value+"%",n="%"+this._txtSongTitle.value+"%",a=this._dateStart.valueAsNumber;isNaN(a)?a=0:a/=1e3;var l=this._dateEnd.valueAsNumber;isNaN(l)?l=Math.floor((new Date).getTime()/1e3):l/=1e3;for(var r=parseInt(this._selLimit.value,10)||25,c=this._pageNumber*r,d=i.PlaylistModel.getInstance().searchTotal(e,s,n,a,l),p=i.PlaylistModel.getInstance().search(e,s,n,a,l,r,c),h=0;h<p.length;++h)p[h].timestamp=new Date(1e3*p[h].timestamp).toUTCString();o("#results").single.textContent=d+" results";var _=Math.ceil(d/r);this._lastPageNumber=_>0?_-1:0;var g=document.getElementById("playlists-table");g&&g.parentElement.removeChild(g),g=this._createTable("playlists-table",["Station","Artist","Song Title","Time"],["station_name","artist_name","song_title","timestamp"],p),o("#playlist-table-container").single.appendChild(g),this._generatePaginationTable(_)},t.prototype._generatePaginationTable=function(t){this._playlistsPagination.classList.remove("hidden");for(var e=0,s=Array.prototype.slice.call(this._playlistsPagination.children);e<s.length;e++){(i=s[e])!==this._playlistsPaginationPrev&&i!==this._playlistsPaginationNext&&this._playlistsPagination.removeChild(i)}for(var n=0;n<t;++n){var i;(i=document.createElement("li")).classList.add("page-item"),n===this._pageNumber&&i.classList.add("active");var a=document.createElement("a"),l=(n+1).toString();a.href="#",a.onclick=function(){return!1},a.dataset.page=l,a.textContent=l,a.addEventListener("click",this._onPaginationLinkClickCallback),i.appendChild(a),this._playlistsPaginationNext.before(i)}0===this._pageNumber?(this._playlistsPaginationPrev.classList.add("disabled"),o('a[data-page="-1"]').single.removeEventListener("click",this._onPaginationLinkClickCallback),t>1?(this._playlistsPaginationNext.classList.remove("disabled"),o('a[data-page="-2"]').single.addEventListener("click",this._onPaginationLinkClickCallback)):(this._playlistsPaginationNext.classList.add("disabled"),o('a[data-page="-2"]').single.removeEventListener("click",this._onPaginationLinkClickCallback))):(this._playlistsPaginationPrev.classList.remove("disabled"),o('a[data-page="-1"]').single.addEventListener("click",this._onPaginationLinkClickCallback),this._pageNumber===t-1?(this._playlistsPaginationNext.classList.add("disabled"),o('a[data-page="-2"]').single.removeEventListener("click",this._onPaginationLinkClickCallback)):(this._playlistsPaginationNext.classList.remove("disabled"),o('a[data-page="-2"]').single.addEventListener("click",this._onPaginationLinkClickCallback)))},t.prototype._onPaginationLinkClick=function(t){var e=parseInt(t.target.dataset.page,10)||0;-1===e&&this._pageNumber>0?--this._pageNumber:-2===e&&this._pageNumber<this._lastPageNumber?++this._pageNumber:e<1?this._pageNumber=0:e>this._lastPageNumber+1?this._pageNumber=this._lastPageNumber:this._pageNumber=e-1,this._performSearch(!1)},t.prototype._createTable=function(t,e,s,n){var i=document.createElement("table");i.id=t,i.classList.add("table","table-striped","table-hover");for(var a=document.createElement("thead"),o=document.createElement("tr"),l=0,r=e;l<r.length;l++){var c=r[l],d=document.createElement("th");d.textContent=c,o.appendChild(d)}a.appendChild(o),i.appendChild(a);for(var p=document.createElement("tbody"),h=0,_=n;h<_.length;h++){var g=_[h];o=document.createElement("tr");for(var u=0,m=s;u<m.length;u++){var y=m[u],S=document.createElement("td");S.textContent=g[y],o.appendChild(S)}p.appendChild(o)}return i.appendChild(p),i},t}();s.UserInterface=l},{"./App":1,"./Exceptions":2,"./PlaylistModel":3}]},{},[1]);